<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="如有问题，还请指摘。">
<meta property="og:type" content="website">
<meta property="og:title" content="Shea的小站">
<meta property="og:url" content="http://sheay.club/index.html">
<meta property="og:site_name" content="Shea的小站">
<meta property="og:description" content="如有问题，还请指摘。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shea的小站">
<meta name="twitter:description" content="如有问题，还请指摘。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://sheay.club/"/>





  <title>Shea的小站</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shea的小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2018/01/03/ELK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/ELK/" itemprop="url">ELK</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T10:06:55+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ELK-Elasticsearch-Logstash-Kibana"><a href="#ELK-Elasticsearch-Logstash-Kibana" class="headerlink" title="ELK (Elasticsearch Logstash Kibana)"></a>ELK (Elasticsearch Logstash Kibana)</h2><p>Though we’re focused more on server setup procedure in this document, I will still give a very brief explanation in laymen terms for ELK. To those who are starting new in this stack, must have already heard of MVC (Model View Controller), so take it like this:</p>
<ul>
<li>Model      <code>=&gt;</code> Elasticsearch (for Storage, Indexing &amp; Search)</li>
<li>View       <code>=&gt;</code> Kibana (for DataViz &amp; G-Man, yeah the one in half life :smirk:)</li>
<li>Controller <code>=&gt;</code> Logstash (For Logs &amp; Filtering)</li>
</ul>
<hr>
<p>Our ELK stack setup has four main components:</p>
<ul>
<li>Logstash: The server component of Logstash that processes incoming logs</li>
<li>Elasticsearch: Stores all of the logs</li>
<li>Kibana: Web interface for searching and visualizing logs, which will be proxied through Nginx</li>
<li>Filebeat: Installed on client servers that will send their logs to Logstash, Filebeat serves as a log shipping agent that utilizes the lumberjack networking protocol to communicate with Logstash</li>
</ul>
<p><img src="https://assets.digitalocean.com/articles/elk/elk-infrastructure.png" alt="ELK+NGINX"></p>
<p><strong>These are the versions we are currently setting up in this installment, please make note accordingly if you have specific version requirements.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">JDK Version - 8</div><div class="line">Elasticsearch - 2.x</div><div class="line">Logstash - 2.2</div><div class="line">Kibana - 4.5</div></pre></td></tr></table></figure>
<h2 id="Installation-Steps"><a href="#Installation-Steps" class="headerlink" title="Installation Steps"></a>Installation Steps</h2><p>For production go with three separate instances for each, elasticsearch, logstash and kibana. Currently we are setting it up on a single machine. You can opt for similar configuration on any cloud provider.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">OS  - Ubuntu 14.04 LTS</div><div class="line">RAM - 4Gb</div><div class="line">CPU - 2</div></pre></td></tr></table></figure>
<p>The amount of CPU, RAM, and storage that your ELK Server will require depends on the volume of logs that you intend to gather.</p>
<p>####AWS<br>Canonical have recently stopped support for smaller instances and hence you can’t pick one from above configuration, so here is a workaround for that (only appreciated in test env) :wink:</p>
<ul>
<li>Go to the following link<ul>
<li><a href="https://cloud-images.ubuntu.com/locator/" target="_blank" rel="external">https://cloud-images.ubuntu.com/locator/</a></li>
</ul>
</li>
<li>Enter the instance ID <code>ami-d05e75b8</code> in the search and once search populated, tap on the value of last column <code>ID</code> of table, which contains same AMI ID.</li>
<li>The next page you will land on is on AWS EC2 select instance type with all enabled.</li>
</ul>
<hr>
<p>####0 - Preliminary (skip if already done)</p>
<ul>
<li><code>$ sudo apt-get update</code></li>
<li><code>$ sudo apt-get upgrade</code></li>
</ul>
<p>####1 - Java 8 Installation</p>
<ul>
<li><p>Add Oracle Java PPA to apt:</p>
<ul>
<li><code>$ sudo add-apt-repository -y ppa:webupd8team/java</code></li>
</ul>
</li>
<li><p>Update your apt package database:</p>
<ul>
<li><code>$ sudo apt-get update</code></li>
</ul>
</li>
<li><p>Install the latest version of Oracle Java 8</p>
<ul>
<li><code>$ sudo apt-get -y install oracle-java8-installer</code></li>
</ul>
</li>
<li><p>Check Java installation</p>
<ul>
<li><code>$ java -version</code></li>
</ul>
</li>
</ul>
<hr>
<p>####2 - Elasticsearch Installation</p>
<ul>
<li><p>Import Elasticsearch public GPG key into apt</p>
<ul>
<li><code>$ wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</code></li>
</ul>
</li>
<li><p>Create the Elasticsearch source list</p>
<ul>
<li><code>$ echo &quot;deb http://packages.elastic.co/elasticsearch/2.x/debian stable main&quot; | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list</code></li>
</ul>
</li>
<li><p>Update your package database</p>
<ul>
<li><code>$ sudo apt-get update</code></li>
</ul>
</li>
<li><p>Install Elasticsearch</p>
<ul>
<li><code>$ sudo apt-get -y install elasticsearch</code></li>
</ul>
</li>
<li><p>Start Elasticsearch service</p>
<ul>
<li><code>$ sudo service elasticsearch restart</code></li>
</ul>
</li>
<li><p>Test</p>
<ul>
<li><code>$ curl localhost:9200</code></li>
</ul>
</li>
<li><p>If the output is similar to this, then you will know that Elasticsearch is running properly:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"status"</span> : <span class="number">200</span>,</div><div class="line">  <span class="attr">"name"</span> : <span class="string">"Nuke - Frank Simpson"</span>,</div><div class="line">  <span class="attr">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="attr">"version"</span> : &#123;</div><div class="line">    <span class="attr">"number"</span> : <span class="string">"1.7.5"</span>,</div><div class="line">    <span class="attr">"build_hash"</span> : <span class="string">"00f95f4ffca6de89d68b7ccaf80d148f1f70e4d4"</span>,</div><div class="line">    <span class="attr">"build_timestamp"</span> : <span class="string">"2016-02-02T09:55:30Z"</span>,</div><div class="line">    <span class="attr">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="attr">"lucene_version"</span> : <span class="string">"4.10.4"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Enable Elasticsearch to start on boot<br><code>$ sudo update-rc.d elasticsearch defaults 95 10</code></p>
</li>
</ul>
<p><strong>Production tip:</strong> DO NOT open any other ports, like 9200, to the world! There are many bots that search for 9200 and execute groovy scripts to overtake machines.</p>
<hr>
<p>####3 - Logstash Installation</p>
<ul>
<li><p>The Logstash package is available from the same repository as Elasticsearch, and public key is already installed, so let’s create the Logstash source list:</p>
<ul>
<li><code>$ echo &#39;deb http://packages.elastic.co/logstash/2.2/debian stable main&#39; | sudo tee /etc/apt/sources.list.d/logstash-2.2.x.list</code> </li>
</ul>
</li>
<li><p>Update apt package database:</p>
<ul>
<li><code>$ sudo apt-get update</code></li>
</ul>
</li>
<li><p>Install Logstash</p>
<ul>
<li><code>$ sudo apt-get install logstash</code></li>
</ul>
</li>
<li><p>Enable start on boot</p>
<ul>
<li><code>$ sudo update-rc.d logstash defaults 97 8</code></li>
</ul>
</li>
<li><p>Run service logstash</p>
<ul>
<li><code>$ sudo service logstash start</code></li>
</ul>
</li>
<li><p>We have yet to configure Logstash, but let leave it for later.</p>
</li>
</ul>
<hr>
<p>####4 - Kibana Installation</p>
<ul>
<li><p>Download and install the Public Signing Key</p>
<ul>
<li><code>$ wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</code></li>
</ul>
</li>
<li><p>Add the repository definition to your <code>/etc/apt/sources.list.d/kibana.list</code> file</p>
<ul>
<li><code>$ echo &quot;deb http://packages.elastic.co/kibana/4.5/debian stable main&quot; | sudo tee -a /etc/apt/sources.list</code></li>
</ul>
</li>
</ul>
<p><strong>WARNING</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Use the echo method described above to add the Kibana repository. Do not use add-apt-repository, as that command adds a deb-src entry with no corresponding source package. When the deb-src entry, is present, the commands in this procedure generate an error similar to the following:</div><div class="line"></div><div class="line">Unable to find expected entry &apos;main/source/Sources&apos; in Release file (Wrong sources.list entry or malformed file)</div><div class="line">Delete the deb-src entry from the /etc/apt/sources.list.d/kibana.list file to clear the error.</div></pre></td></tr></table></figure></p>
<ul>
<li><p>Update apt and install Kibana</p>
<ul>
<li><code>$ sudo apt-get update &amp;&amp; sudo apt-get install kibana</code></li>
</ul>
</li>
<li><p>Open Kibana configuration file for editing</p>
<ul>
<li><code>$ sudo vi /opt/kibana/config/kibana.yml</code></li>
</ul>
</li>
<li><p>In the Kibana configuration file, find the line that specifies <em>server.host</em>, uncomment and replace the IP address (“0.0.0.0” by default) with “localhost”:</p>
<ul>
<li><code>server.host: &quot;localhost&quot;</code></li>
<li>Save and exit. This setting makes it so Kibana will only be accessible to the localhost. This is fine because we will use an Nginx reverse proxy to allow external access.</li>
</ul>
</li>
<li><p>Enable start on boot</p>
<ul>
<li><code>$ sudo update-rc.d kibana defaults 95 10</code></li>
</ul>
</li>
<li><p>Start service Kibana</p>
<ul>
<li><code>$ sudo service kibana start</code></li>
</ul>
</li>
<li><p>Before we can use the Kibana web interface, we have to set up a reverse proxy. Let’s do that now, with Nginx.</p>
</li>
</ul>
<hr>
<p>####3 - Nginx Installation<br><strong>Note:</strong> If you already have an Nginx instance that you want to use, feel free to use that instead. Just make sure to configure Kibana so it is reachable by your Nginx server (you probably want to change the host value, in /opt/kibana/config/kibana.yml, to your Kibana server’s private IP address or hostname). Also, it is recommended that you enable SSL/TLS.</p>
<ul>
<li><p>Install Nginx and Apt-utils</p>
<ul>
<li><code>$ sudo apt-get install nginx apache2-utils</code></li>
</ul>
</li>
<li><p>Create an admin user and assign password to it</p>
<ul>
<li><code>$ sudo htpasswd -c /etc/nginx/htpasswd.users kibanaadmin</code></li>
</ul>
</li>
<li><p>Now open the nginx default server block</p>
<ul>
<li><code>$ sudo vim /etc/nginx/sites-available/default</code></li>
</ul>
</li>
<li><p>Delete the file’s contents, and paste the following code block into the file.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  listen 80;</div><div class="line">    server_name kibana;</div><div class="line"></div><div class="line"></div><div class="line">  error_log   /var/log/nginx/kibana.error.log;</div><div class="line">  access_log  /var/log/nginx/kibana.access.log;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    rewrite ^/(.*) /$1 break;</div><div class="line">    proxy_ignore_client_abort on;</div><div class="line">    proxy_pass http://localhost:5601;</div><div class="line">    proxy_set_header  X-Real-IP  $remote_addr;</div><div class="line">    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">    proxy_set_header  Host $http_host;</div><div class="line">   </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Save and exit. This configures Nginx to direct your server’s HTTP traffic to the Kibana application, which is listening on <code>localhost:5601</code>.</li>
</ul>
</li>
<li><p>Now restart Nginx to reflect your changes</p>
<ul>
<li><code>$ sudo service nginx restart</code></li>
</ul>
</li>
<li><p>Kibana is now accessible via your FQDN or the public IP address of your ELK Server i.e.</p>
<ul>
<li><code>http://elk\_server\_public\_ip/</code></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/30/nginx-优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/30/nginx-优化/" itemprop="url">nginx 优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-30T11:02:34+08:00">
                2017-09-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>lnmp已经成为比较流行的网站服务器端技术配备。越来越多的人开始不满足于能使用nginx，更多人开始关注如何能优化nginx的处理能力。</p>
<p>使用nginx的目的就是为了提高并发处理能力，但是看到有部分人本机部署lanmp，在同一台机器上使用nginx方向代理apache，就有种脱裤子放屁的感觉。</p>
<p>在window下运行nginx，还要跑出好的效果，同样是个伪命题，windows下的select模型注定nginx效率不会太高。</p>
<p>最近看了篇英文文章，结合自己理解，写给大家看看吧。</p>
<p>优化nginx包括两方面：</p>
<p>1.是自己重写nginx代码(比如tengine)、本身nginx的代码已经足够优秀，如果不是每秒几千的请求，就忽略这个部分吧。</p>
<p>2.另一个就是和优化nginx的配置，这是中小型网站可以重点优化的部分。</p>
<p>nginx的配置文件是一种声明式定义，控制nginx的每一个细节。</p>
<p>所谓负载调优，就是提高单台机器处理效率，降低单台机器的负载。</p>
<p>为了提高单台机器的处理效率，cpu的处理速度是足够快的，我们能解决的就是降低磁盘I/O、网络I/O，减少内存使用。</p>
<p>降低单台机器的负载我们能做的就是负载均衡，把流量打到多台机器处理。</p>
<p>nginx推荐优化内容：</p>
<p>1.open files数量优化<br>ulimit -a查看系统参数<br>其中<br>open files (-n) 1024<br>表示系统同时最多能打开的文件数，linux下的所有设备都可以认为是文件，包括网络连接，如果同时超过1024个连接，那么nginx的日志就会报“24: Too many open files”</p>
<p>多以优化的第一步就是设置open files为ulimit</p>
<p>修改/etc/profile,增加<br>ulimit -n 65535</p>
<p>2.Worker Processes数量优化<br>通常来说设置一个cpu核心对应一个worker processer，最多不超过4个，提高worker process的值是为了提高计算能力，但一般在越到cpu瓶颈前，你会遇到别的瓶颈(如网络问题)。</p>
<p>只有当你要处理大量静态文件的磁盘I/O时，worker进程是单线程的，所以这个读取文件的阻塞IO会降低CPU的处理速度，这是可以增加worker进程数量，其它情况是不需要的。</p>
<p>3.worker进程连接数优化(Worker Connections)<br>默认情况下这个值是worker_connections 1024，也就是说考虑到keep-alive超时65秒，每个浏览器平均消耗两个链接(chrome会同时打开多个连接来提到加载速度)。</p>
<p>那么默认情况下nginx平均每秒能处理1024/65/2=8，那么8*86440=64w，差不多相当于每天有60万ip。</p>
<p>多以普通网站默认值就可以了，如果你的流量一直提升，可以考虑增加这个值为2048或者更高。</p>
<ol>
<li><p>CPU Affinity<br>用来设置worker进程使用哪个cpu核心处理请求并且一直使用这个cpu核心。如果你不知道cpu调度，最好别碰这个，操作系统比你更懂如何调度。</p>
</li>
<li><p>Keep Alive</p>
</li>
</ol>
<p>Keep alive 没有数据传输的情况下保持客户端和服务端的连接，也就是保持空连接一段时间，避免重现建立链接的时间消耗。nginx处理空连接的效率非常高，1万个空连接大约消耗2.5M内存。如果流量非常大的网站，减少建立连接的时间开销是非常客观的。keep alive的值设置在10-20s之间比较合理。</p>
<ol>
<li><p>tcp_nodelay 和 tcp_nopush优化<br>这两个指令影响nginx的底层网络，它们决定操作系统如何处理网络层buffer和什么时候把buffer内容刷新给终端用户。如果你不懂，就可以保持这两个指令默认不变，对nginx性能影响不明显。</p>
</li>
<li><p>access日志优化<br>默认情况下，access日志会记录所有请求到日志文件，写操作会增加IO操作，如果不需要统计信息，可以使用百度统计或者cnzz统计，完全可以关闭日志，来减少磁盘写，或者写入内存文件，提高IO效率。</p>
</li>
<li><p>Error日志优化<br>错误日志会记录运行中的错误，如果设置的太低，会记录的信息太多，会产生大量IO，推荐设置为warn，这样可以记录大部分信息，而不会有太多IO</p>
</li>
<li><p>Open File Cache<br>nginx会读文件系统的许多文件，如果这些文件的描述符能够缓存起来，那么会提高处理效率。详见<a href="http://wiki.nginx.org/HttpCoreModule#open_file_cache" target="_blank" rel="external">http://wiki.nginx.org/HttpCoreModule#open_file_cache</a></p>
</li>
<li><p>Buffers size优化<br>buffer的大小是你需要调优最重要参数。如果buffer size太小就会到导致nginx使用临时文件存储response，这会引起磁盘读写IO，流量越大问题越明显。</p>
</li>
</ol>
<p>client_body_buffer_size 处理客户端请求体buffer大小。用来处理POST提交数据，上传文件等。client_body_buffer_size 需要足够大以容纳如果需要上传POST数据。</p>
<p>fastcgi_buffers，proxy_buffers 处理后端（PHP,Apache）响应。如果这个buffer不够大，同样会引起磁盘都系IO。需要注意的是它们有一个上限值，这个上限值受 fastcgi_max_temp_file_size 、 proxy_max_temp_file_size控制。</p>
<p>10.磁盘IO<br>如果能把数据全放到内存，不使用磁盘就可以完全去掉磁盘IO。 默认情况下操作系统也会缓存频繁访问的数据以降低IO。所以预算足够的情况加，加大内存。</p>
<p>11.网络IO<br>假设我们没有了磁盘IO，所有数据都在内存，那么我们的读IO大概有3-6gbps。这种情况下，如果你网络差，一样会很慢。所以尽可能提高网络带宽，压缩传输数据。</p>
<p>网络带宽买你能买的起的最大带宽，nginx的gzip模块可以用来压缩传输数据，通常gzip_comp_level 设为 4-5，再高就是浪费cpu了。同时也可以采用css，js压缩技术，当然这些技术就与nginx优化无关了。。</p>
<p>绝招<br>如果你还想提高nginx处理能力，只能祭出大杀器了。别优化了，加机器吧。一点点优化是没有用的，不如扩展机器来的快些。</p>
<p>ps<br>说道系统的扩展性通常有scale、和extension，区别是前者是数量上扩展，后者是功能上扩展。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/29/Supervisor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/29/Supervisor/" itemprop="url">如何正确的部署 FLASK 项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-29T17:48:22+08:00">
                2017-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#系统 Python 设置<br>由于每个 Linux 发行版的内置 Python 都不太一样，而且为了避免你的项目在不同的 Python 版本下出现各种奇怪问题。比如，requests 库在python 2.7.5 的环境下访问 HTTPS 网站会出现 SNI 的问题，导致访问失败。<br>所以我们需要使用 pyenv 和 virtualenv 。<br>注：强烈不建议直接更新系统里面的 Python ，否则你会出现各种各样的奇怪问题</p>
<p>#pyenv<br>pyenv 允许你在一台机器上配置多个版本的 python 环境<br>安装</p>
<p>&lt;sudo apt-get install curl git-core // 依赖库</p>
<p>&lt;curl -L <a href="https://raw.github.com/yyuu/pyenv-installer/master/bin/pyenv-installer" target="_blank" rel="external">https://raw.github.com/yyuu/pyenv-installer/master/bin/pyenv-installer</a> | bash<br>如果执行成功，那么 pyenv 就会安装到 ~/.pyenv 目录里面。<br>为了方便我们用 pyenv subcommand 的方法来调用 pyenv ，我们要在 ~/.bashrc 文件中添加以下内容</p>
<blockquote>
<p>export PYENV_ROOT=”${HOME}/.pyenv”</p>
<p>if [ -d “${PYENV_ROOT}” ]; then<br> export PATH=”${PYENV_ROOT}/bin:${PATH}”<br> eval “$(pyenv init -)”<br>fi<br>~/.bashrc 的作用大概就是用户配置文件<br>执行 source ~/.bashrc 以重新加载用户配置文件。<br>至此，pyenv 就安装好了。</p>
<p>#使用<br>pyenv install –list<br>列出目前 pyenv 安装过的所有 Python 版本<br>pyenv install $version<br>$version 就是你想要安装的 Python 版本<br>pyenv versions<br>显示当前系统用的是哪个 Python 版本<br>pyenv global $version<br>把当前系统的 Python 版本切换到 $version 这个版本。该命令在本教材中并不用到，故不多介绍，如果你想了解更多，可以查看pyenv 的 API 文档</p>
</blockquote>
<p>#virtualenv<br>用于分离 Python 库</p>
<p>##安装<br>如果你是使用以上的方法安装pyenv的话，那么 virtualenv 就已经安装完了。强烈不建议用其他方法安装 virtualenv， 那将会是一种很麻烦很折腾的方法</p>
<p>##使用</p>
<blockquote>
<p>pyenv virtualenv $version $name<br>用于创建一个指定 Python 版本的虚拟环境<br>    &lt;$version 你需要的 Python 版本<br>    &lt;$name 该虚拟环境的名称</p>
<p>&lt;rm -rf ~/.pyenv/versions/$name/<br>删除名称为$name的虚拟环境。<br>注意： 这里用到了rm -rf 谨慎使用，使用前先检查代码</p>
</blockquote>
<p>#基本需求<br>首先我们需要一下这几个库来来帮助我们部署，建议在 virtualenv 中安装，以免感染系统</p>
<blockquote>
<p>gunicorn<br>用 WSGI 的方式来启动 flask 项目<br>gevent<br>python 中比较好的网络库，提供更加高效的 I/O 读写<br>supervisor<br>守护进程，避免进程意外退出<br>安装方法：<br>pip install gunicorn gevent supervisor</p>
</blockquote>
<p>#部署你的 Flask 项目</p>
<p>##Flask 项目结构<br>为了做演示，我们暂定需要部署的 Flask 项目结构是这个样子的</p>
<blockquote>
<p>flaskproject<br>|—-app<br>|—-|—-templates<br>|—-|—-static<br>|—-|—-models.py<br>|—-|—-views<br>|—-|—-|—-<strong>init</strong>.py<br>|—-|—-|—-user.py<br>|—-|—-functions.py<br>|—-config.py<br>|—-run.py<br>项目结构并不是固定的，可以自己根据自己项目的情况自行分配<br>run.py 中就是 Flask 项目的入口，内容大致如下<br>from flask import Flask<br>app = Flask()<br>… some configs<br>或者使用create_app() 模式<br>from flask import Flask<br>def create_app():<br>   app = Flask()</p>
<h1 id="…-some-configs"><a href="#…-some-configs" class="headerlink" title="… some configs"></a>… some configs</h1><p>   return app</p>
<p>##Supervisor + Gunicorn + Gevent<br>前提设置<br>首先启动之前已经创建好的 virtualenv 虚拟环境<br>pyenv activate $name<br>如果正常启动的话，在 bash 命令行上面应该会出现环境的名字<br>($name) #<br>没正常启动的样子是这样的<br>#<br>进去之后呢，用pip 安装你的项目依赖<br>pip install -r requirements.txt</p>
<p>#配置 Supervisor<br>进入项目文件夹<br>然后输出 supervisor 默认配置文件 supervisor.conf : ($name 是 virtualenv 环境的名称)<br>~/.pyenv/versions/$name/bin/echo_supervisord_conf &gt; supervisor.conf<br>然后打开 supervisor.conf ，然后在文件的最后添加一下内容<br>[program:myapp]<br>command=~/.pyenv/versions/$name/bin/gunicorn -k gevent -w2 -b0.0.0.0:9000 run:app   ; supervisor启动命令<br>directory=/home/myproject                                                 ; 项目的文件夹路径<br>startsecs=0                                                               ; 启动时间<br>stopwaitsecs=0                                                            ; 终止等待时间<br>autostart=true                                                            ; 是否自动启动<br>autorestart=true                                                          ; 是否自动重启<br>stdout_logfile=/home/myproject/log/gunicorn.log                           ; log 日志<br>stderr_logfile=/home/myproject/log/gunicorn.err                           ; 错误日志<br>ommand 中的是用 gunicorn 和 gevent 启用 Flask 项目的命令<br>-w2 指的是 2 worker 一般设置成 2 * cpu_nums<br>-b0.0.0.0:9000 指的是启动在 9000 端口<br>run:app 是 Flask 项目入口，如果你用的是create_app() 方法的话， 就改成run:create_app()<br>所有目录都需要使用绝对路径</p>
<p>##操作 Supervisor<br>启动 Supervisor</p>
</blockquote>
<p>~/.pyenv/versions/$name/bin/supervisord -c supervisor.conf</p>
<p>查看 Supervisor 情况</p>
<p>~/.pyenv/versions/$name/bin/supervisorctl -c supervisor.conf status</p>
<p>重启 Supervisor</p>
<p>~/.pyenv/versions/$name/bin/supervisorctl -c supervisor.conf reload</p>
<p>启动 Supervisor 中某个 / 全部程序</p>
<p>~/.pyenv/versions/$name/bin/supervisorctl -c supervisor.conf start [all][appname]</p>
<p>关闭 Supervisor 中某个 / 全部程序</p>
<p>~/.pyenv/versions/$name/bin/supervisorctl -c supervisor.conf stop [all][appname]<br>配置好你的 supervisor.conf 文件后，执行启动命令，如果没打错命令基本就已经启动好了，这个时候你应该就可以访问 <a href="http://ip:9000" target="_blank" rel="external">http://ip:9000</a> 来访问到你的 Flask 项目</p>
<p>#Nginx 设置</p>
<p>##Nginx 安装</p>
<p>##Nginx 配置<br>进入 Nginx配置文件，或者/etc/nginx/conf.d/default.conf ，或者新建 /etc/nginx/conf.d/myproject.conf，修改配置文件，以下这是几个建议的配置</p>
<p>###禁止 IP 访问<br>server {<br>    listen       80 default_server;<br>    listen       [::]:80 default_server;<br>    server<em>name  </em>;</p>
<pre><code>location / {
    return 404;
}
</code></pre><p>}</p>
<p>###禁止 HTTP 访问<br>server {<br>    listen               80;<br>    server_name          www.myproject.com myproject.com;<br>    server_tokens        off;</p>
<pre><code># 跳转至 HTTPS
location / {
    rewrite ^/(.*)$ https://myproject.com/$1 permanent;
}
</code></pre><p>}</p>
<p>###HTTPS设置 / 443端口设置<br>server {<br>    listen               443 ssl http2 fastopen=3 reuseport;</p>
<pre><code>server_name          www.myproject.com myproject.com;
server_tokens        off;
</code></pre><h1 id="SSL-设置"><a href="#SSL-设置" class="headerlink" title="SSL 设置"></a>SSL 设置</h1><pre><code>ssl_certificate      /root/.acme.sh/myproject.com_ecc/fullchain.cer;
ssl_certificate_key  /root/.acme.sh/myproject.com_ecc/myproject.com.key;
ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
ssl_prefer_server_ciphers  on;
ssl_protocols              TLSv1 TLSv1.1 TLSv1.2;
ssl_session_cache          shared:SSL:50m;
ssl_session_timeout        1d;
ssl_session_tickets        on;
ssl_stapling               on;
ssl_stapling_verify        on;
resolver                   114.114.114.114 valid=300s;
resolver_timeout           10s;
</code></pre><h1 id="NGINX-日志"><a href="#NGINX-日志" class="headerlink" title="NGINX 日志"></a>NGINX 日志</h1><pre><code>access_log                 /home/myproject/log/nginx.log;
</code></pre><h1 id="禁止非-GET-HEAD-POST-OPTIONS-的访问"><a href="#禁止非-GET-HEAD-POST-OPTIONS-的访问" class="headerlink" title="禁止非 GET HEAD POST OPTIONS 的访问"></a>禁止非 GET HEAD POST OPTIONS 的访问</h1><pre><code>if ($request_method !~ ^(GET|HEAD|POST|OPTIONS)$ ) {
    return           444;
}
</code></pre><h1 id="www-myproject-com-跳转至-myproject-com"><a href="#www-myproject-com-跳转至-myproject-com" class="headerlink" title="www.myproject.com 跳转至 myproject.com"></a>www.myproject.com 跳转至 myproject.com</h1><h1 id="可有可无，看个人情况"><a href="#可有可无，看个人情况" class="headerlink" title="可有可无，看个人情况"></a>可有可无，看个人情况</h1><pre><code>if ($host != &apos;myproject.com&apos; ) {
    rewrite          ^/(.*)$  https://myproject.com/$1 permanent;
}
</code></pre><h1 id="代理-Flask-端口"><a href="#代理-Flask-端口" class="headerlink" title="代理 Flask 端口"></a>代理 Flask 端口</h1><pre><code>location / {
    proxy_http_version       1.1;

  # HSTS 头设置
    add_header               Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot;;
    add_header               X-Frame-Options deny;

    # 添加两个 Request Header
    proxy_set_header         X-Real_IP        $remote_addr;
    proxy_set_header         X-Forwarded-For  $proxy_add_x_forwarded_for;

  # 代理 9000 端口
    proxy_pass               http://127.0.0.1:9000;
}
</code></pre><p>}<br>这里的SSL申请是用 acme.sh 申请的 Let‘s Encrypt ECC证书</p>
<p>然后重启 Nginx ，项目就配置完成了。就可以使用域名正常访问了（DNS解析正常的情况下）</p>
<p>##快捷使用方式<br>因为 Python 的执行方式不像 PHP 那样的脚本式执行，所以当项目代码更新后，需要重启才能使代码生效。</p>
<p>为了方便重启，我们在项目的根目录下创建reload.sh</p>
<p>git pull  // 我是使用 git 拉去项目代码的，这里的作用是更新项目代码<br>~/.pyenv/versions/$name/bin/supervisorctl -c supervisor.conf reload  // 重启 Supervisor<br>echo ‘Reload Done’<br>下次我们就可以直接用 sh reload.sh 来直接更新项目状态了</p>
<p>#注意事项<br>服务器的配置不止如此，iptables 等等相关软件限制端口访问<br>建议只允许 HTTPS 访问<br>如果不限制端口访问，不建议把 supervisor 配置中的监听端口暴露（即使用9000端口）<br>待完善的内容</p>
<p>建议使用 fabric来代替sh reload.sh 的执行方式<br>log 文件如何更高效地分析<br>期待下一篇文章把，下一次将完善这些内容</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/27/Linux-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/27/Linux-command/" itemprop="url">Linux command</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-27T15:28:12+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>linux添加https证书</p>
<blockquote>
<p>wget -qO - <a href="https://linux-packages.resilio.com/resilio-sync/key.asc" target="_blank" rel="external">https://linux-packages.resilio.com/resilio-sync/key.asc</a> | sudo apt-key add -</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/22/Ubuntu-修改时间、时区/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/22/Ubuntu-修改时间、时区/" itemprop="url">Ubuntu 修改时间、时区</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T10:52:21+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Linux默认情况下使用UTC格式作为标准时间格式，如果在Linux下运行程序，且在程 序中指定了与系统不一样的时区的时候，可能会造成时间错误。如果是Ubuntu的桌面版，则可以直接在图形模式下修改时区信息，但如果是在Server版 呢，则需要通过tzconfig来修改时区信息了。使用方式(如将时区设置成Asia/Chongqing)：<br>sudo tzconfig，如果命令不存在请使用 dpkg-reconfigure tzdata</p>
<p>然后按照提示选择 Asia对应的序号，选完后会显示一堆新的提示—输入城市名，如Shanghai或Chongqing，最后再用 sudo date -s “” 来修改本地时间。</p>
<p>按照提示进行选择时区，然后：</p>
<p>sudo cp /usr/share/zoneinfo/Asia/ShangHai /etc/localtime  </p>
<p>上面的命令是防止系统重启后时区改变。<br>网上同步时间</p>
<pre><code>1.  安装ntpdate工具

# sudo apt-get install ntpdate

2.  设置系统时间与网络时间同步

# ntpdate cn.pool.ntp.org

3.  将系统时间写入硬件时间

# hwclock –systohc
</code></pre><p>cn.pool.ntp.org是位于中国的公共NTP服务器，用来同步你的时间(如果你的时间与服务器的时间截不同的话，可能无法同步时间哟，甚至连sudo reboot这样的指令也无法执行)。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/13/Linux高并发socket限制解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/13/Linux高并发socket限制解决/" itemprop="url">Linux高并发socket限制解决</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-13T16:27:03+08:00">
                2017-09-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、修改用户进程可打开文件数限制<br>在Linux平台上，无论编写客户端程序还是服务端程序，在进行高并发TCP连接处理时，最高的并发数量都要受到系统对用户单一进程同时可打开文件数量的限制(这是因为系统为每个TCP连接都要创建一个socket句柄，每个socket句柄同时也是一个文件句柄)。可使用ulimit命令查看系统允许当前用户进程打开的文件数限制：<br>[speng@as4 ~]$ ulimit -n<br>1024<br>这表示当前用户的每个进程最多允许同时打开1024个文件，这1024个文件中还得除去每个进程必然打开的标准输入，标准输出，标准错误，服务器监听 socket，进程间通讯的unix域socket等文件，那么剩下的可用于客户端socket连接的文件数就只有大概1024-10=1014个左右。也就是说缺省情况下，基于Linux的通讯程序最多允许同时1014个TCP并发连接。<br>对于想支持更高数量的TCP并发连接的通讯处理程序，就必须修改Linux对当前用户的进程同时打开的文件数量的软限制(soft limit)和硬限制(hardlimit)。其中软限制是指Linux在当前系统能够承受的范围内进一步限制用户同时打开的文件数；硬限制则是根据系统硬件资源状况(主要是系统内存)计算出来的系统最多可同时打开的文件数量。通常软限制小于或等于硬限制。<br>修改上述限制的最简单的办法就是使用ulimit命令：<br>[speng@as4 ~]$ ulimit -n<br>上述命令中，在中指定要设置的单一进程允许打开的最大文件数。如果系统回显类似于“Operation notpermitted”之类的话，说明上述限制修改失败，实际上是因为在中指定的数值超过了Linux系统对该用户打开文件数的软限制或硬限制。因此，就需要修改Linux系统对用户的关于打开文件数的软限制和硬限制。<br>第一步，修改/etc/security/limits.conf文件，在文件中添加如下行：<br>speng soft nofile 10240<br>speng hard nofile 10240<br>其中speng指定了要修改哪个用户的打开文件数限制，可用<em>号表示修改所有用户的限制；soft或hard指定要修改软限制还是硬限制；10240则指定了想要修改的新的限制值，即最大打开文件数(请注意软限制值要小于或等于硬限制)。修改完后保存文件。<br>第二步，修改/etc/pam.d/login文件，在文件中添加如下行：<br>session required /lib/security/pam_limits.so<br>这是告诉Linux在用户完成系统登录后，应该调用pam_limits.so模块来设置系统对该用户可使用的各种资源数量的最大限制(包括用户可打开的最大文件数限制)，而pam_limits.so模块就会从/etc/security/limits.conf文件中读取配置来设置这些限制值。修改完后保存此文件。<br>第三步，查看Linux系统级的最大打开文件数限制，使用如下命令：<br>[speng@as4 ~]$ cat /proc/sys/fs/file-max<br>12158<br>这表明这台Linux系统最多允许同时打开(即包含所有用户打开文件数总和)12158个文件，是Linux系统级硬限制，所有用户级的打开文件数限制都不应超过这个数值。通常这个系统级硬限制是Linux系统在启动时根据系统硬件资源状况计算出来的最佳的最大同时打开文件数限制，如果没有特殊需要，不应该修改此限制，除非想为用户级打开文件数限制设置超过此限制的值。修改此硬限制的方法是修改/etc/rc.local脚本，在脚本中添加如下行：<br>echo 22158 &gt; /proc/sys/fs/file-max<br>这是让Linux在启动完成后强行将系统级打开文件数硬限制设置为22158。修改完后保存此文件。<br>完成上述步骤后重启系统，一般情况下就可以将Linux系统对指定用户的单一进程允许同时打开的最大文件数限制设为指定的数值。如果重启后用 ulimit-n命令查看用户可打开文件数限制仍然低于上述步骤中设置的最大值，这可能是因为在用户登录脚本/etc/profile中使用ulimit -n命令已经将用户可同时打开的文件数做了限制。由于通过ulimit-n修改系统对用户可同时打开文件的最大数限制时，新修改的值只能小于或等于上次 ulimit-n设置的值，因此想用此命令增大这个限制值是不可能的。所以，如果有上述问题存在，就只能去打开/etc/profile脚本文件，在文件中查找是否使用了ulimit-n限制了用户可同时打开的最大文件数量，如果找到，则删除这行命令，或者将其设置的值改为合适的值，然后保存文件，用户退出并重新登录系统即可。<br>通过上述步骤，就为支持高并发TCP连接处理的通讯处理程序解除关于打开文件数量方面的系统限制。<br>2、修改网络内核对TCP连接的有关限制（参考对比下篇文章“优化内核参数”）<br>在Linux上编写支持高并发TCP连接的客户端通讯处理程序时，有时会发现尽管已经解除了系统对用户同时打开文件数的限制，但仍会出现并发TCP连接数增加到一定数量时，再也无法成功建立新的TCP连接的现象。出现这种现在的原因有多种。<br>第一种原因可能是因为Linux网络内核对本地端口号范围有限制。此时，进一步分析为什么无法建立TCP连接，会发现问题出在connect()调用返回失败，查看系统错误提示消息是“Can’t assign requestedaddress”。同时，如果在此时用tcpdump工具监视网络，会发现根本没有TCP连接时客户端发SYN包的网络流量。这些情况说明问题在于本地Linux系统内核中有限制。其实，问题的根本原因在于Linux内核的TCP/IP协议实现模块对系统中所有的客户端TCP连接对应的本地端口号的范围进行了限制(例如，内核限制本地端口号的范围为1024~32768之间)。当系统中某一时刻同时存在太多的TCP客户端连接时，由于每个TCP客户端连接都要占用一个唯一的本地端口号(此端口号在系统的本地端口号范围限制中)，如果现有的TCP客户端连接已将所有的本地端口号占满，则此时就无法为新的TCP客户端连接分配一个本地端口号了，因此系统会在这种情况下在connect()调用中返回失败，并将错误提示消息设为“Can’t assignrequested address”。有关这些控制逻辑可以查看Linux内核源代码，以linux2.6内核为例，可以查看tcp_ipv4.c文件中如下函数：<br>static int tcp_v4_hash_connect(struct sock </em>sk)<br>请注意上述函数中对变量sysctl_local_port_range的访问控制。变量sysctl_local_port_range的初始化则是在tcp.c文件中的如下函数中设置：<br>void __init tcp_init(void)<br>内核编译时默认设置的本地端口号范围可能太小，因此需要修改此本地端口范围限制。<br>第一步，修改/etc/sysctl.conf文件，在文件中添加如下行：<br>net.ipv4.ip_local_port_range = 1024 65000<br>这表明将系统对本地端口范围限制设置为1024~65000之间。请注意，本地端口范围的最小值必须大于或等于1024；而端口范围的最大值则应小于或等于65535。修改完后保存此文件。<br>第二步，执行sysctl命令：<br>[speng@as4 ~]$ sysctl -p<br>如果系统没有错误提示，就表明新的本地端口范围设置成功。如果按上述端口范围进行设置，则理论上单独一个进程最多可以同时建立60000多个TCP客户端连接。<br>第二种无法建立TCP连接的原因可能是因为Linux网络内核的IP_TABLE防火墙对最大跟踪的TCP连接数有限制。此时程序会表现为在 connect()调用中阻塞，如同死机，如果用tcpdump工具监视网络，也会发现根本没有TCP连接时客户端发SYN包的网络流量。由于 IP_TABLE防火墙在内核中会对每个TCP连接的状态进行跟踪，跟踪信息将会放在位于内核内存中的conntrackdatabase中，这个数据库的大小有限，当系统中存在过多的TCP连接时，数据库容量不足，IP_TABLE无法为新的TCP连接建立跟踪信息，于是表现为在connect()调用中阻塞。此时就必须修改内核对最大跟踪的TCP连接数的限制，方法同修改内核对本地端口号范围的限制是类似的：<br>第一步，修改/etc/sysctl.conf文件，在文件中添加如下行：<br>net.ipv4.ip_conntrack_max = 10240<br>这表明将系统对最大跟踪的TCP连接数限制设置为10240。请注意，此限制值要尽量小，以节省对内核内存的占用。<br>第二步，执行sysctl命令：<br>[speng@as4 ~]$ sysctl -p<br>如果系统没有错误提示，就表明系统对新的最大跟踪的TCP连接数限制修改成功。如果按上述参数进行设置，则理论上单独一个进程最多可以同时建立10000多个TCP客户端连接。<br>3、使用支持高并发网络I/O的编程技术<br>在Linux上编写高并发TCP连接应用程序时，必须使用合适的网络I/O技术和I/O事件分派机制。<br>可用的I/O技术有同步I/O，非阻塞式同步I/O(也称反应式I/O)，以及异步I/O。在高TCP并发的情形下，如果使用同步I/O，这会严重阻塞程序的运转，除非为每个TCP连接的I/O创建一个线程。但是，过多的线程又会因系统对线程的调度造成巨大开销。因此，在高TCP并发的情形下使用同步 I/O是不可取的，这时可以考虑使用非阻塞式同步I/O或异步I/O。非阻塞式同步I/O的技术包括使用select()，poll()，epoll等机制。异步I/O的技术就是使用AIO。<br>从I/O事件分派机制来看，使用select()是不合适的，因为它所支持的并发连接数有限(通常在1024个以内)。如果考虑性能，poll()也是不合适的，尽管它可以支持的较高的TCP并发数，但是由于其采用“轮询”机制，当并发数较高时，其运行效率相当低，并可能存在I/O事件分派不均，导致部分TCP连接上的I/O出现“饥饿”现象。而如果使用epoll或AIO，则没有上述问题(早期Linux内核的AIO技术实现是通过在内核中为每个 I/O请求创建一个线程来实现的，这种实现机制在高并发TCP连接的情形下使用其实也有严重的性能问题。但在最新的Linux内核中，AIO的实现已经得到改进)。<br>综上所述，在开发支持高并发TCP连接的Linux应用程序时，应尽量使用epoll或AIO技术来实现并发的TCP连接上的I/O控制，这将为提升程序对高并发TCP连接的支持提供有效的I/O保证。</p>
<p>内核参数sysctl.conf的优化</p>
<p>/etc/sysctl.conf 是用来控制linux网络的配置文件，对于依赖网络的程序（如web服务器和cache服务器）非常重要，RHEL默认提供的最好调整。</p>
<p>推荐配置（把原/etc/sysctl.conf内容清掉，把下面内容复制进去）：<br>net.ipv4.ip_local_port_range = 1024 65536<br>net.core.rmem_max=16777216<br>net.core.wmem_max=16777216<br>net.ipv4.tcp_rmem=4096 87380 16777216<br>net.ipv4.tcp_wmem=4096 65536 16777216<br>net.ipv4.tcp_fin_timeout = 10<br>net.ipv4.tcp_tw_recycle = 1<br>net.ipv4.tcp_timestamps = 0<br>net.ipv4.tcp_window_scaling = 0<br>net.ipv4.tcp_sack = 0<br>net.core.netdev_max_backlog = 30000<br>net.ipv4.tcp_no_metrics_save=1<br>net.core.somaxconn = 262144<br>net.ipv4.tcp_syncookies = 0<br>net.ipv4.tcp_max_orphans = 262144<br>net.ipv4.tcp_max_syn_backlog = 262144<br>net.ipv4.tcp_synack_retries = 2<br>net.ipv4.tcp_syn_retries = 2</p>
<p>这个配置参考于cache服务器varnish的推荐配置和SunOne 服务器系统优化的推荐配置。</p>
<p>varnish调优推荐配置的地址为：<a href="http://varnish.projects.linpro.no/wiki/Performance" target="_blank" rel="external">http://varnish.projects.linpro.no/wiki/Performance</a></p>
<p>不过varnish推荐的配置是有问题的，实际运行表明“net.ipv4.tcp_fin_timeout = 3”的配置会导致页面经常打不开；并且当网友使用的是IE6浏览器时，访问网站一段时间后，所有网页都会打不开，重启浏览器后正常。可能是国外的网速快吧，我们国情决定需要调整“net.ipv4.tcp_fin_timeout = 10”，在10s的情况下，一切正常（实际运行结论）。</p>
<p>修改完毕后，执行：<br>/sbin/sysctl -p /etc/sysctl.conf<br>/sbin/sysctl -w net.ipv4.route.flush=1</p>
<p>命令生效。为了保险起见，也可以reboot系统。</p>
<p>调整文件数：<br>linux系统优化完网络必须调高系统允许打开的文件数才能支持大的并发，默认1024是远远不够的。</p>
<p>执行命令：<br>Shell代码<br>echo ulimit -HSn 65536 &gt;&gt; /etc/rc.local<br>echo ulimit -HSn 65536 &gt;&gt;/root/.bash_profile<br>ulimit -HSn 65536</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/09/04/Start-Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/Start-Docker/" itemprop="url">Start-Docker</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T15:03:25+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装：</p>
<blockquote>
<p>sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’<br>{<br> “registry-mirrors”: [“<a href="https://iwki5hdk.mirror.aliyuncs.com" target="_blank" rel="external">https://iwki5hdk.mirror.aliyuncs.com</a>“]<br>}<br>EOF<br>sudo service docker restart</p>
</blockquote>
<p>Docker启动过程：</p>
<p>检查本地是否存在指定的镜像，不存在就从公有仓库下载<br>利用镜像创建并启动一个容器<br>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层<br>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去<br>从地址池配置一个ip地址给容器<br>执行用户指定的应用程序<br>执行完毕后容器被终止</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/08/25/Gitlab-Installing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/25/Gitlab-Installing/" itemprop="url">Gitlab Installing</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-25T11:12:12+08:00">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Gitlab 简介<br>GitHub是2008年由Ruby on Rails编写而成，与业界闻名的Github类似;但要将代码上传到GitHub上面，而且将项目设为私有还要收费。GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，可通过Web界面进行访问公开的或者私人项目，非常适合在团队内部使用。<br>在gitlab中有三个版本，分别是CE（社区版）、EE（企业版）、OM（RPM包完整版，里面包括nginx、Redis等其它软件，比较大）。这里的编译安装版，是指CE版的源码安装<br>官网<a href="https://docs.gitlab.com/" target="_blank" rel="external">https://docs.gitlab.com/</a></p>
<p>##使用omnibus packages安装</p>
<p>###在 Ubuntu 14 安装<br>使用国内安装源镜像，加快安装速度。修改/etc/apt/sources.list.d/gitlab-ce.list:</p>
<blockquote>
<p>curl <a href="https://packages.gitlab.com/gpg.key" target="_blank" rel="external">https://packages.gitlab.com/gpg.key</a> 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null<br>vi /etc/apt/sources.list.d/gitlab-ce.list<br>deb <a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/debian" target="_blank" rel="external">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/debian</a> jessie main<br>开始安装<br>安装依赖包<br>sudo apt-get install curl openssh-server ca-certificates postfix<br>安装 GitLab 社区版<br>apt-get install gitlab-ce<br>初始化，初始化完自动启动 GitLab<br>sudo gitlab-ctl reconfigure</p>
</blockquote>
<p>###问题</p>
<p>####CXABI_1.3.8….not found<br>解决方案</p>
<blockquote>
<p>sudo add-apt-repository ppa:ubuntu-toolchain-r/test<br>sudo apt-get update<br>sudo apt-get install gcc-4.9 g++-4.9</p>
</blockquote>
<p>####Excepted process tp exit with [0], but received ‘137’<br>内存不足，导致OOM关闭，解决方案增加内存。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/08/16/Confluence-Installing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/Confluence-Installing/" itemprop="url">Confluence Installing</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T11:41:32+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>ubuntu==14.04</li>
<li>confluence==5.5</li>
<li>postgres==9.4</li>
<li>java==1.7</li>
</ul>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="下载需要的安装包-lt-需要添加链接-gt"><a href="#下载需要的安装包-lt-需要添加链接-gt" class="headerlink" title="下载需要的安装包 &lt;需要添加链接&gt;"></a>下载需要的安装包 &lt;需要添加链接&gt;</h3><h3 id="解压并安装"><a href="#解压并安装" class="headerlink" title="解压并安装"></a>解压并安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./atlassian-confluence-5.5.4-x64.bin</div></pre></td></tr></table></figure>
<h3 id="打开浏览器，http-localhost-8090"><a href="#打开浏览器，http-localhost-8090" class="headerlink" title="打开浏览器，http://localhost:8090"></a>打开浏览器，<a href="http://localhost:8090" target="_blank" rel="external">http://localhost:8090</a></h3><p>记下这里的Server ID：ADFI-2763-6EJC-35Q4</p>
<h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##### 停止服务</div><div class="line">$ service confluence stop  </div><div class="line">$ unzip confluence5.1-crack.zip  </div><div class="line">$ cd confluence5.1-crack  </div><div class="line">$ ls </div><div class="line">atlassian-extras-2.4.jar  iNViSiBLE </div><div class="line">$ ./keygen.sh</div></pre></td></tr></table></figure>
<h3 id="导入破解文件"><a href="#导入破解文件" class="headerlink" title="导入破解文件"></a>导入破解文件</h3><p>将破解后的授权文件导入到目录中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cp atlassian-extras-2.4.jar  /usr/local/confluence/confluence/WEB-INF/lib/</div></pre></td></tr></table></figure></p>
<h2 id="创建confluence数据库"><a href="#创建confluence数据库" class="headerlink" title="创建confluence数据库"></a>创建confluence数据库</h2><p>创建名为confluence的pg数据库和新建一个用于confluence的用户</p>
<h3 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h3><h3 id="web安装"><a href="#web安装" class="headerlink" title="web安装"></a>web安装</h3><p>按照安装引导，输入相关字段进行安装</p>
<h3 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">导入汉化文件</div><div class="line">$cp Confluence-5.4.4-language-pack-zh_CN.jar  /opt/atlassian/confluence/confluence/WEB-INF/lib/</div><div class="line">汉化完重启</div><div class="line">$ service confluence restart</div></pre></td></tr></table></figure>
<h3 id="至此完成"><a href="#至此完成" class="headerlink" title="至此完成"></a>至此完成</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sheay.club/2017/08/16/Ubuntu-Mysql-Installing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shea">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shea的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/Ubuntu-Mysql-Installing/" itemprop="url">Ubuntu Mysql Installing</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T11:41:13+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Shea" />
          <p class="site-author-name" itemprop="name">Shea</p>
           
              <p class="site-description motion-element" itemprop="description">如有问题，还请指摘。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shea</span>

  
</div>


  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    主题 &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Mist
    </a>
  </div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
